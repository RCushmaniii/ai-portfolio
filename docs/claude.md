# CLAUDE.md — Portfolio Sync Engine

> This file provides context for Claude Code (and other AI coding assistants) to understand the project structure, conventions, and implementation patterns.

---

> **IMPORTANT: Proactive Product Advisor**
>
> You are not just a code assistant — you are a product advisor. **Proactively challenge complexity** and advocate for simplicity in every feature, UI, and implementation decision.
>
> **Core Principles:**
>
> 1. **Simplify UX** — If a feature adds complexity users don't need, suggest removing it
> 2. **"It Just Works"** — Modern apps don't ask users to configure things that should be automatic
> 3. **Fewer Choices = Better** — Don't expose settings users shouldn't need to think about
> 4. **Challenge Requirements** — If something seems over-engineered, say so and propose simpler alternatives
> 5. **Think Like a User** — Would your mom understand this UI? If not, simplify it
>
> **Use phrases like:**
> - *"Do users really need a Start/Stop button, or should the service just always run?"*
> - *"This setting adds complexity — can we just pick a sensible default?"*
> - *"Instead of 3 options, what if we just did the right thing automatically?"*
>
> **Apply this guidance proactively** — don't wait to be asked. If you see unnecessary complexity, speak up.

---

## Project Summary

**What:** A Next.js application that aggregates portfolio data from GitHub repositories and displays them in a professional, filterable interface.

**Why:** Showcase AI consulting work for CushLabs.ai to technical founders, engineering managers, and recruiters.

**How:** Each GitHub repo contains a `PORTFOLIO.md` file with structured frontmatter. A sync script fetches these, enriches with GitHub API data, and generates static JSON consumed at build time.

## Quick Reference

| Item | Value |
|------|-------|
| Framework | Next.js 14+ (App Router) |
| Language | TypeScript (strict) |
| Styling | Tailwind CSS + shadcn/ui |
| Package Manager | pnpm |
| Node Version | 20+ LTS |
| Deployment | Vercel |
| GitHub User | `RCushmaniii` |

## Directory Structure

```
portfolio-sync-engine/
├── CLAUDE.md                    # This file
├── .env.local                   # GITHUB_TOKEN (never commit)
├── content/
│   └── portfolio.json           # Generated by sync script
├── scripts/
│   └── sync-portfolio.ts        # GitHub → JSON sync
├── src/
│   ├── app/
│   │   ├── portfolio/
│   │   │   ├── page.tsx         # Grid view
│   │   │   └── [slug]/page.tsx  # Detail view
│   │   ├── layout.tsx
│   │   └── globals.css
│   ├── components/
│   │   ├── ui/                  # shadcn/ui (don't modify)
│   │   └── portfolio/           # Custom portfolio components
│   └── lib/
│       ├── portfolio/           # Data loading, types, filters
│       └── utils.ts             # Shared utilities
└── public/
    └── images/                  # Static assets
```

## Key Files to Understand

| File | Purpose | Notes |
|------|---------|-------|
| `scripts/sync-portfolio.ts` | Fetches PORTFOLIO.md from repos, outputs JSON | Run with `pnpm sync` |
| `src/lib/portfolio/types.ts` | TypeScript interfaces for all data | Single source of truth for types |
| `src/lib/portfolio/loader.ts` | Reads portfolio.json at build time | Used in page components |
| `content/portfolio.json` | Generated data file | Never edit manually |

## Architectural Decisions

### Why Static JSON Instead of Runtime API Calls?

1. **Performance:** No API latency on page load
2. **Reliability:** No GitHub API rate limits affecting users
3. **Cost:** No serverless function invocations
4. **Simplicity:** Data changes infrequently (weekly at most)

### Why Sync Script Instead of Build-Time Fetch?

1. **Control:** Explicit sync lets us review changes before deploy
2. **Debugging:** Easier to inspect portfolio.json locally
3. **Speed:** Faster builds (no API calls during build)

### Why shadcn/ui?

1. **Copy-paste:** Components live in our codebase, fully customizable
2. **Consistency:** Pre-built accessible components
3. **Tailwind-native:** No CSS conflicts

## Code Patterns

### Component File Structure

```typescript
// src/components/portfolio/PortfolioCard.tsx

import { Card, CardContent, CardHeader } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import type { PortfolioProject } from '@/lib/portfolio/types';

interface PortfolioCardProps {
  project: PortfolioProject;
}

export function PortfolioCard({ project }: PortfolioCardProps) {
  // Component logic here
}
```

### Data Loading Pattern (App Router)

```typescript
// src/app/portfolio/page.tsx

import { getPortfolioProjects } from '@/lib/portfolio/loader';
import { PortfolioGrid } from '@/components/portfolio/PortfolioGrid';

export default async function PortfolioPage() {
  const projects = await getPortfolioProjects();
  return <PortfolioGrid projects={projects} />;
}
```

### Dynamic Route Pattern

```typescript
// src/app/portfolio/[slug]/page.tsx

import { getPortfolioProjects, getProjectBySlug } from '@/lib/portfolio/loader';
import { notFound } from 'next/navigation';

export async function generateStaticParams() {
  const projects = await getPortfolioProjects();
  return projects.map((p) => ({ slug: p.slug }));
}

export default async function ProjectPage({ params }: { params: { slug: string } }) {
  const project = await getProjectBySlug(params.slug);
  if (!project) notFound();
  return <PortfolioDetail project={project} />;
}
```

### Filter State in URL

```typescript
// Use nuqs or manual searchParams for URL state
// Example: /portfolio?category=ai-automation&sort=recent

'use client';

import { useSearchParams, useRouter } from 'next/navigation';

export function CategoryFilter() {
  const searchParams = useSearchParams();
  const router = useRouter();
  const category = searchParams.get('category') || 'all';

  const setCategory = (value: string) => {
    const params = new URLSearchParams(searchParams);
    if (value === 'all') {
      params.delete('category');
    } else {
      params.set('category', value);
    }
    router.push(`/portfolio?${params.toString()}`);
  };

  // ...
}
```

## Naming Conventions

| Type | Convention | Example |
|------|------------|---------|
| Components | PascalCase | `PortfolioCard.tsx` |
| Utilities | camelCase | `filterProjects.ts` |
| Types/Interfaces | PascalCase | `PortfolioProject` |
| Constants | SCREAMING_SNAKE | `GITHUB_API_URL` |
| CSS classes | Tailwind utilities | `className="flex items-center gap-2"` |
| File names | kebab-case (pages) | `[slug]/page.tsx` |

## Type Safety Rules

1. **No `any` types** — Use `unknown` and narrow, or define proper types
2. **Zod for external data** — All data from GitHub API must be validated
3. **Explicit return types** — All exported functions must have return types
4. **Strict null checks** — Handle `null`/`undefined` explicitly

```typescript
// ❌ Bad
function getProject(slug: string) {
  return projects.find(p => p.slug === slug);
}

// ✅ Good
function getProject(slug: string): PortfolioProject | undefined {
  return projects.find(p => p.slug === slug);
}
```

## Common Tasks

### Add a New shadcn/ui Component

```powershell
pnpm dlx shadcn@latest add [component-name]
```

### Run the Sync Script

```powershell
pnpm sync
```

### Start Development Server

```powershell
pnpm dev
```

### Build for Production

```powershell
pnpm build
```

### Type Check

```powershell
pnpm typecheck
```

## Things to Avoid

| Don't | Why | Instead |
|-------|-----|---------|
| Edit `content/portfolio.json` manually | Gets overwritten by sync | Edit PORTFOLIO.md in repos |
| Modify files in `src/components/ui/` | shadcn components are generated | Create wrapper components |
| Use `getServerSideProps` | We want static generation | Use `generateStaticParams` |
| Fetch GitHub API at runtime | Rate limits, latency | Use pre-synced JSON |
| Use CSS modules or styled-components | Project uses Tailwind | Use Tailwind classes |
| Add `"use client"` to page components | Breaks static generation | Keep pages as server components |
| Use `any` type | Breaks type safety | Define proper interfaces |

## Error Handling

### Sync Script Errors

```typescript
// Log error but continue to next repo
try {
  const data = await fetchPortfolioMd(repo.name);
  // process...
} catch (error) {
  console.error(`[ERROR] ${repo.name}:`, error instanceof Error ? error.message : error);
  // Don't rethrow — continue to next repo
}
```

### Missing Data in Components

```typescript
// Always provide fallbacks
<img
  src={project.thumbnail || '/images/fallback-thumbnail.png'}
  alt={project.title}
/>

{project.hero_images.length > 0 ? (
  <ImageCarousel images={project.hero_images} />
) : (
  <div className="aspect-video bg-muted" />
)}
```

## Testing Commands

```powershell
# Verify sync works
pnpm sync

# Verify build works
pnpm build

# Check for type errors
pnpm typecheck

# Run dev server and manually test
pnpm dev
```

## Environment Variables

| Variable | Required | Description |
|----------|----------|-------------|
| `GITHUB_TOKEN` | Yes (sync only) | Personal access token for GitHub API |
| `NEXT_PUBLIC_SITE_URL` | No | Base URL for OG images |

## Deployment

This project deploys to Vercel. The sync script runs locally (or in CI) before deploy.

```powershell
# Full deploy flow
pnpm sync          # Update portfolio.json
git add .
git commit -m "Sync portfolio data"
git push           # Triggers Vercel deploy
```

## Questions to Ask Before Implementing

1. Does this component need client-side interactivity? → If yes, use `"use client"`
2. Is this data from GitHub API? → Must be validated with Zod
3. Can this be a Server Component? → Prefer server components for data fetching
4. Does this need to be in the URL? → Filter/sort state should be in URL params

## Resources

- [Next.js App Router Docs](https://nextjs.org/docs/app)
- [shadcn/ui Components](https://ui.shadcn.com/docs/components)
- [Tailwind CSS Docs](https://tailwindcss.com/docs)
- [GitHub REST API](https://docs.github.com/en/rest)
- [Zod Documentation](https://zod.dev/)
